name: docker
method: os
is_essential: true
gentoo:
  packages:
    - name: app-containers/docker
    - name: app-containers/docker-cli
  hook:
    after: |-
      sudo usermod -aG docker $USER
      sudo rc-update add docker default
      sudo rc-service docker start
arch:
  packages:
    - name: docker
  hook:
    after: |-
      sudo groupadd docker
      sudo usermod -aG docker $USER
      sudo systemctl enable --now docker containerd
ubuntu:
  packages:
    - name: docker-ce
    - name: docker-ce-cli
  hook:
    before: |-
      sudo apt remove -y $(dpkg --get-selections docker.io docker-compose docker-compose-v2 docker-doc podman-docker containerd runc | cut -f1)

      # Add Docker's official GPG key:
      sudo apt-get update
      sudo apt-get install -y ca-certificates curl
      sudo install -m 0755 -d /etc/apt/keyrings
      sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
      sudo chmod a+r /etc/apt/keyrings/docker.asc

      # Add the repository to Apt sources:
      sudo tee /etc/apt/sources.list.d/docker.sources <<EOF
      Types: deb
      URIs: https://download.docker.com/linux/ubuntu
      Suites: $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}")
      Components: stable
      Signed-By: /etc/apt/keyrings/docker.asc
      EOF

      sudo apt update
    after: |-
      sudo groupadd docker
      sudo usermod -aG docker $USER
      sudo systemctl enable --now docker containerd
macos:
  packages:
    - name: docker
      cask: true
