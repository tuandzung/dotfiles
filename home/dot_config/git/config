# vim:expandtab:shiftwidth=8:tabstop=8:softtabstop=8:ft=gitconfig
[user]
        email = mail@tuandzung.me
        name = Ngo Tuan Dzung
        signingkey = ~/.ssh/keys/personal_ed25519.pub
[feature]
        # Optimize for repos with many files in the working directory
        manyFiles = true

[gpg]
        format = ssh

[gpg "ssh"]
        allowedSignersFile = ~/.ssh/allowed_signers

[commit]
        gpgsign = true
        cleanup = scissors

[tag]
        # Sort tags by version
        sort = version:refname
        # Always sign tag
        forceSignAnnotated = true
        gpgsign = true

[core]
        editor = nvim
        pager = delta --pager='ov -F'
        autocrlf = false
        whitespace = trailing-space,space-before-tab,tab-in-indent,cr-at-eol
        # Custom global ignore file
        excludesfile = ~/.config/git/ignore
        # Custom global attributes file
        attributesfile = ~/.config/git/attributes

[pager]
        show = delta --features ov-diff
        diff = delta --features ov-diff
        log = delta --features ov-log

[interactive]
        diffFilter = delta --color-only

[delta]
        # Use delta with catppuccin theme
        features = "catppuccin-macchiato"
        # Show navigate section
        navigate = true
        # Show line number & Two side
        side-by-side = true
        line-numbers = true
        # Style of whitespace error
        whitespace-error-style = red reverse

[delta "ov-diff"]
        pager = ov -F --section-delimiter '^(commit|added:|removed:|renamed:|Δ)' --section-header --pattern '•'
[delta "ov-log"]
        pager = ov -F --section-delimiter '^(commit|\\* commit|\\* \\w{7})' --section-header-num 1

[merge]
        conflictstyle = zdiff3

[rerere]
        enabled = true
        autoupdate = true

[versionsort]
        suffix = ""
        suffix = "-rc"
        suffix = "-pre"

[diff]
        tool = nvimdiff
        colorMoved = default
        noprefix = true
        algorithm = histogram

[mergetool]
        prompt = false
        keepBackup = false

[difftool]
        prompt = false

[difftool "nvimdiff"]
        # Nvim diff 2 files
        cmd = "nvim -d $LOCAL $REMOTE"

[difftool "kitty"]
        # Use kitten of kitty/ to diff each hunk
        cmd = "kitty +kitten diff $LOCAL $REMOTE"

[mergetool "nvimdiff"]
        # Nvim diff 4 files
        cmd = "nvim -d $BASE $LOCAL $REMOTE $MERGED -c '$wincmd w' -c 'wincmd J'"

[color]
        # Be careful with pipe when redirected output
        ui = auto
[color "status"]
        added = green
        changed = blue
        untracked = magenta
        deleted = red
[color "diff"]
        meta = cyan
        frag = magenta bold
        old = red
        new = blue
        commit = yellow bold
        whitespace = red reverse
[color "diff-highlight"]
        oldNormal = red bold
        oldHighLight = red bold 52
        newNormal = blue bold
        newHighLight = blue bold 45

[status]
        # Show summary of submodule
        submoduleSummary = true

[apply]
        # Auto fix white space
        whitespace = fix

[rebase]
        # More clear when rebase
        instructionFormat = "[%an - %ar] %s"

[stash]
        # Show stash with diff
        showPatch = true

[transfer]
        # Avoid paranoid
        fsckobjects = true

[fetch]
        # Prune remote-tracking branches that no longer exist on the remote
        prune = true
        pruneTags = true

[push]
        # Only push current branch to same name branch
        default = current
        # Push follow tags
        followTags = true

[submodule]
        # Fetch submodules parallel
        fetchJobs = 0

[gc]
        # Don't auto git gc, with large project can slow when working
        auto = 0

[init]
        defaultBranch = main

[alias]
        # Get main branch
        main = "!_() { git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@'; }; _"
        # Graph log view
        graph = log --graph --abbrev-commit
        # Meaning stash
        snapshot = !git stash save "Snapshot: $(date)"
        # Rename stash
        stash-rename = "!_() { rev=$(git rev-parse $1) && git stash drop $1 || exit 1 ; git diff-index --quiet HEAD; s=$?; [ $s != 0 ] && git stash save \"tmp stash from stash-rename\"; git stash apply $rev && shift && git stash save \"$@\" && [ $s != 0 ] && git stash pop stash@{1}; }; _"
        # Find commits with source code
        find-source = "!_() { git log --pretty=format:'%C(yellow)%h %Cblue%ad  %Creset%s%Cgreen  [%cn] %Cred%d' --decorate --date=short -S$1; }; _"
        # Find commits with message
        find-message = "!_() { git log --pretty=format:'%C(yellow)%h %Cblue%ad  %Creset%s%Cgreen  [%cn] %Cred%d' --decorate --date=short --grep=$1; }; _"
        # Find branches containing commit
        find-branch = "!_() { git branch -a --contains $1; }; _"
        # Stop tracking a file that already in staged but keep in worktree
        stop-track = "!_() { git update-index --assume-unchanged $1; }; _"
        # Redo above
        track = "!_() { git update-index --no-assume-unchanged $1; }; _"
        # Keep independent version file forever
        keep-forever = "!_() { git update-index --skip-worktree $1; }; _"
        # Redo above
        stop-keep-forever = "!_() { git update-index --no-skip-worktree $1; }; _"
        # Show root level directory
        root = "!_() { git rev-parse --show-toplevel; }; _"
        # Show file with conflicts
        conflicts = "!_() { git ls-files -u | awk '{print $4}' | sort -u; }; _"
        # Delete dangling commits
        delete-dangling = "!_() { git reflog expire --expire=now --all; git gc --prune=now; }; _"
        # Delete merged branch
        delete-merged = "!_() { git branch --merged | grep -v $(git main) | grep -v develop | xargs git branch -d; }; _"
        # Submodule clean
        submodule-clean = "!_() { git submodule update --init --recursive && git submodule foreach --recursive 'git reset --hard' && git submodule foreach --recursive 'git clean -fd' }; _"
        # Update main branch
        update-main = !bash ~/.config/git/helper.sh update_main

[include]
        path = ~/.config/git/diff-filter
        path = ~/.config/git/delta

[includeIf "gitdir/i:~/Working/**"]
        # Include config file from enterprise project
        path = ~/Working/.gitconfig

# Enforce SSH
[url "git@github.com:"]
        insteadOf = https://github.com/

[url "git@gitlab.com:"]
        insteadOf = https://gitlab.com/
